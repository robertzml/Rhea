@model Rhea.UI.Models.DepartmentHistoryModel
@{
    ViewBag.Title = "部门历史数据";
    Layout = null;
}

<div class="page-header">
    <h3>
        @ViewBag.Title</h3>
</div>

<div class="row-fluid">
    <div class="span12">
        <select id="archive-list">
            <option value="">--- 当前 ---</option>
        @foreach (var item in Model.DepartmentArchiveList)
        {
            <option value="@item._id.ToString()">@item.RelateTime.Value.ToLongDateString()</option>
        }
        </select>
        <table class="responsive table table-bordered table-striped">
            <thead>
                <tr>
                    <td>属性</td><td>值</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>房间总数</td>
                    <td id="room-count"></td>
                </tr>
                <tr>
                    <td>总面积(m<sup>2</sup>)</td>
                    <td id="total-area"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="department-archive">
</div>


<script type="text/javascript">
    $(function () {
        var departmentId = '@Model.DepartmentId';
        loadArchiveDepartment(departmentId, "");

        $('#archive-list').change(function () {
            var aid = $(this).val();

            loadArchiveDepartment(departmentId, aid);
        });

        function loadArchiveRoom(departmentId, logId) {
            $.getJSON('/Department/GetArchiveRoom', { id: departmentId, logId: logId }, function (response) {
                $('#room-count').text(response.length);
                var totalArea = 0.0;
                $.each(response, function (i, item) {
                    totalArea = totalArea + item.UsableArea;
                });
                $('#total-area').text(totalArea.toFixed(2));
            });
        }

        function loadArchiveDepartment(departmentId, logId) {
            $.get('/Department/GetArchiveDepartment', { id: departmentId, logId: logId }, function (response) {
                $('#department-archive').html(response);
            });
        }
    });
</script>
