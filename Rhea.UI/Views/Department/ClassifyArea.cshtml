@model int
@{
    ViewBag.Title = "部门分类用房面积";
    Layout = null;
}

<div class="box">
    <div class="box-header well" data-original-title>
        <h2>
            <i class="icon-th-list"></i>部门分类用房面积</h2>
    </div>
    <div class="box-content">
        <div id="container-classify-area" style="width: 100%; height:350px;">
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        var chart1; 
        var colors = Highcharts.getOptions().colors;
        var categories = []; 
        var data1 = [], data2 = [];   

        $.getJSON('/Department/GetClassifyArea', { id: @Model }, function (response) {
            setColumnData(response);
            //setLineData(response);           
            setColumnChart(data1);
        });

        function setColumnData(response) {            
            $.each(response.FirstClassify, function(i, item) {                
                var cate0 = [], data0 = []; 
                $.each(item.SecondClassify, function(i, item) {
                    cate0.push(item.FunctionProperty);
                    data0.push(parseFloat(item.Area));
                });

                data1.push( { name: item.Title, y: parseFloat(item.Area), color: colors[i],
                    drilldown: { name: item.Title, color: colors[i], categories: cate0, data: data0 }
                });
                categories.push(item.Title);
            });
        }; 

        function setLineData(response) {
            $.each(response.FirstClassify, function(i, item) {                
                var cate0 = [], data0 = []; 
                $.each(item.SecondClassify, function(i, item) {
                    cate0.push(item.FunctionProperty);
                    data0.push(parseInt(item.RoomCount));
                });

                data2.push( { name: item.Title, y: parseInt(item.RoomCount), color: colors[4],
                    drilldown: { name: item.Title, color: colors[4], categories: cate0, data: data0 }
                });                
            });
        };

        function setChart(name, categories, data, color) {
			chart1.xAxis[0].setCategories(categories, false);
			//chart1.series[0].remove(false);
            while (chart1.series.length > 0){
                chart1.series[0].remove(true);
            }
			chart1.addSeries({
				name: name,
				data: data,
                type: 'column',
				color: color || 'gray'
			}, false);            
			chart1.redraw();
        } 

        function setColumnChart(dataA) {
            var nameA = '面积', nameB = '房间数量';
            var option = {
                chart: {
                    renderTo: 'container-classify-area',
                    zoomType: 'xy'
                    //type: 'column'
                },
                title: {
                    text: '分类用房面积图'
                },               
                credits: {
                    enabled: false
                },
                xAxis: {
                    categories: categories
                },
                yAxis: {
                    min: 0,
                    labels: {
                        format: '{value}'                        
                    },
                    title: {
                        text: '面积 (m2)'
                    }
                },
                plotOptions: {
                    column: {
                        cursor: 'pointer',
                        point: {
                            events: {
                                click: function () {
                                    var drilldown = this.drilldown;                                   
                                    if (drilldown) { // drill down
                                        setChart(drilldown.name, drilldown.categories, drilldown.data, drilldown.color);
                                    } else { // restore
                                        setChart(nameA, categories, dataA);
                                    }
                                }
                            }
                        },
                        dataLabels: {
                            enabled: true,
                            color: colors[0],
                            style: {
                                fontWeight: 'bold'
                            },
                            formatter: function () {
                                return this.y;
                            }
                        }
                    }
                },
                tooltip: {                    
                    formatter: function () {
                        var point = this.point;
                        s = this.x + ':<b>' + this.y + ' m<sup>2</sup></b><br/>'; 
                        //s += '房间数量:<b>' + this.points[1].y + '</b><br/>';
                        if (point.drilldown) {
                            s += '点击显示 ' + point.category + ' 详细';
                        } else {
                            s += '点击回到上一级';
                        }
                        return s;
                    }
                },
                series: [{
                    name: nameA,
                    data: dataA,
                    type: 'column',
                    color: 'gray'
                }],
                exporting: {
                    enabled: true
                }
            };
           
            chart1 = new Highcharts.Chart(option);
        };
    });
</script>