@model Rhea.Model.Estate.Room

@{
    ViewBag.Title = "房间分配";
    Layout = null;
    AjaxOptions ajaxOpts = new AjaxOptions
    {
        UpdateTargetId = "ajax-content2",
        Url = Url.Action("Assign", "Room", new { area = "Estate" })        
    };  
}

<div class="page-header">
    <h3>
        @ViewBag.Title</h3>
</div>

<div class="row-fluid">
    <div class="span6">
        <div class="box">
            <div class="title">
                <h4>
                    <span>当前部门</span>
                </h4>
            </div>

            <div class="content noPad">
                <table class="responsive table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>
                                属性
                            </th>
                            <th>
                                值
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>部门名称</td>
                            <td>@Model.DepartmentName()</td>
                        </tr>
                        <tr>
                            <td>部门现有面积</td>
                            <td>@ViewBag.DepartmentArea</td>
                        </tr>
                        <tr>
                            <td>分配后面积</td>
                            <td>@(ViewBag.DepartmentArea - Model.UsableArea)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="box">
            <div class="title">
                <h4>
                    <span>新部门</span>
                </h4>
            </div>

            <div class="content">
                @using (Ajax.BeginForm("Assign", new { controller = "Room", area = "Estate" }, ajaxOpts, new { @class = "horizontal" }))
                {                 
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true)
                    @Html.Hidden("RoomId", Model.Id)
                    @Html.Hidden("CurrentDepartmentId", Model.DepartmentId)
                    <div class="form-row row-fluid">
                        <div class="span12">
                            <div class="row-fluid">
                                <label class="form-label span4" for="checkboxes">部门选择</label>
                                <div class="span8 controls">   
                                    @Html.Action("DropdownList", new { controller = "Department", area = "" })
                                </div> 
                            </div>
                        </div> 
                    </div>

                    <div class="form-row row-fluid">
                        <div class="span12">
                            <div class="row-fluid">
                                <label class="form-label span4" for="normal">部门现有面积</label>
                                <input class="span8" type="text" id="currentArea" readonly="readonly" value="" />
                            </div>
                        </div> 
                    </div>

                    <div class="form-row row-fluid"> 
                        <div class="span12">
                            <div class="row-fluid">
                                <label class="form-label span4">分配后面积</label>
                                <input class="span8" type="text" id="futureArea"  readonly="readonly" value="" />
                            </div>
                        </div> 
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-info">确定</button>                        
                    </div>               
                }
            </div>
        </div>
    </div>

     <div class="span6">
        <div class="box">
            <div class="title">
                <h4>
                    <span class="icon16 icomoon-icon-camera"></span><span>房间属性</span>
                </h4>
                <a href="#" class="minimize">Minimize</a>
            </div>
            <div class="content noPad">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th style="width:30%">
                                属性
                            </th>
                            <th style="width:70%">
                                值
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Number)
                            </td>
                            <td>
                                @Model.Number
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Name)
                            </td>
                            <td>
                                @Model.Name
                            </td>
                        </tr>
                        <tr>
                            <td>
                                一级分类
                            </td>
                            <td>
                                @Model.Function.ClassifyName
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Function)
                            </td>
                            <td>
                                @Model.Function.Property
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.BuildingId)
                            </td>
                            <td>
                                @Model.BuildingName()
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Floor)
                            </td>
                            <td>
                                @Model.Floor / @Model.TotalFloor()
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.BuildArea)
                            </td>
                            <td>
                                @Model.BuildArea
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.UsableArea)
                            </td>
                            <td>
                                @Model.UsableArea
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Span)
                            </td>
                            <td>
                                @Model.Span
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.Orientation)
                            </td>
                            <td>
                                @Model.Orientation
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.DisplayNameFor(model => model.RoomStatus)
                            </td>
                            <td>
                                @Model.RoomStatus
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $('#DepartmentId').change(function () {
            var sid = $(this).val();
            if (sid != "") {
                var roomArea = parseFloat('@Model.UsableArea');
                $.getJSON('/Department/GetArea', { id: sid }, function (response) {
                    $('input#currentArea').val(response.Area);
                    $('input#futureArea').val(response.Area + roomArea);
                });
            }
        });
    });
</script>