@model Rhea.Data.Entities.Building

@{
    ViewBag.Title = "楼层信息";
    Layout = null;
}

<div class="box">
<div class="box-header well" data-original-title>
    <h2>
        <i class="icon-th-list"></i>楼层信息</h2>
</div>

<div class="box-content">
    <div class="page-header">
        <h1>
            @Model.Name <small>Id: @Model.Id</small>
        
            <span>楼层:</span>
            <select data-bind="options: floors,
                                optionsText: 'name',
                                value: chosenFloor">
            </select>
        
        </h1>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <h3>
                详细参数</h3>            
            <div class="row-fluid" data-bind="with: chosenFloor">
                <div class="span4">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>
                                    属性
                                </th>
                                <th>
                                    值
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    编号
                                </td>
                                <td data-bind="text: number"></td>
                            </tr>
                            <tr>
                                <td>
                                    名称
                                </td>
                                <td data-bind="text: name"></td>
                            </tr>                            
                        </tbody>
                    </table>
                </div>
                <div class="span4">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>
                                    属性
                                </th>
                                <th>
                                    值
                                </th>
                            </tr>
                        </thead>
                        <tbody>                            
                            <tr>
                                <td>
                                    建筑面积
                                </td>
                                <td data-bind="text: buildArea">
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    使用面积
                                </td>
                                <td data-bind="text: usableArea">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="span4">                   
                    <div class="well" data-bind="text: remark">
                        备注:
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <h2>
                操作</h2>
            <p>
                <a class="btn" id="edit" href="#"><i class="icon-edit"></i>编辑</a> 
                <a class="btn" id="return" href="#"><i class="icon-arrow-left"></i>返回</a>
            </p>
        </div>
    </div>
</div>
</div>

<div class="box">
    <div class="box-header well" data-original-title>
        <h2>
            <i class="icon-camera"></i>楼层平面图</h2>
    </div>
    <div class="box-content">

    </div> 
</div>

<div class="box">
    <div class="box-header well" data-original-title>
        <h2>
            <i class="icon-align-left"></i>房间列表</h2>
    </div>
    <div class="box-content">
        <table id="room-list" class="table table-striped table-bordered bootstrap-datatable datatable">
            <thead>
                <tr>
                    <th>
                        房间号
                    </th>
                    <th>
                        名称
                    </th>
                    <th>
                        楼层
                    </th>
                    <th>
                        功能
                    </th>
                    <th>
                        操作
                    </th>                    
                </tr>
            </thead>
            <tbody>                               
            </tbody>
        </table>
    </div>
</div>

<script src="@Url.Content("~/Areas/Estate/Scripts/floor-model.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {              
        var floorModel = new FloorViewModel();   

        $.each(@Html.Raw(ViewBag.Floors), function(i, item){            
	        floorModel.addFloor(item.Id, item.Number, item.Name, item.BuildArea, item.UsableArea, item.ImageUrl, item.Remark);            
        });

        var f = floorModel.findFloor(@ViewBag.FloorId);
        floorModel.setFloor(f);

        //floorModel.getRooms(@Model.Id);

        ko.applyBindings(floorModel);             

        $.getJSON("/Estate/Room/List", { buildingId: @Model.Id }, function(data) {
            var items = [];

			$.each(data, function(i, item) {
                items.push('<tr><td>' + item.Number + '</td><td>' + item.Name + '</td><td>' +
                    item.Floor + '</td><td>' + item.Function.Property + 
                    '</td><td><a class="btn btn-success room-view" ref="'+ parseInt(item.Id) + 
                    '" href="#"><i class="icon-zoom-in icon-white"></i>查看</a></td></tr>');
			});

            $('table#room-list tbody').html(items.join(''));
		

            $('.datatable').dataTable({
			    "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
			    "sPaginationType": "bootstrap",
			    "oLanguage": {
			        "sLengthMenu": "每页 _MENU_ 条记录",
                    "sInfo": "显示 _START_ 至 _END_ 共有 _TOTAL_ 条记录",
			    }
		    });
        });

        $('a#return').click(function() {
            ajaxLoadPage('Details', 'Building', 'Estate', { id: '@Model.Id' });
            return false;
        });   
    });
</script>